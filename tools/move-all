#!/usr/bin/env bash

# Move files whose names match ALL given words (case-insensitive)
# into a directory named "selected_files" by default.
#
# Usage:
#   script.sh [-m maxdepth] [-t target_dir] word1 [word2 ...]

set -euo pipefail

usage() {
  echo "Usage: $0 [-m maxdepth] [-t target_dir] word1 [word2 ... wordN]" >&2
  exit 1
}

# Defaults
MAXDEPTH=1
TARGET_DIR="./selected_files"

# Parse options
while getopts ":m:t:" opt; do
  case "$opt" in
    m)
      MAXDEPTH="$OPTARG"
      ;;
    t)
      TARGET_DIR="$OPTARG"
      ;;
    \?)
      echo "Unknown option: -$OPTARG" >&2
      usage
      ;;
    :)
      echo "Option -$OPTARG requires an argument." >&2
      usage
      ;;
  esac
done

shift $((OPTIND - 1))

# At least one search word is required
if [ "$#" -lt 1 ]; then
  echo "Error: at least one search word is required." >&2
  usage
fi

if [ ! -d "$TARGET_DIR" ]; then
  mkdir -p "$TARGET_DIR"
fi

# Build the list of -iname conditions for find
pattern_args=()
for word in "$@"; do
  pattern_args+=( -iname "*${word}*" )
done

# Find files up to MAXDEPTH whose names contain ALL words, then move them to TARGET_DIR
find . -maxdepth "$MAXDEPTH" -type f "${pattern_args[@]}" -exec mv {} "$TARGET_DIR"/ \;

